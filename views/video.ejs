<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"> -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <div class="container mt-4">
  <h1 class="text-center mb-4">Recorded Videos</h1>

  <div id="video-list" class="row g-3"></div>
</div>

<script>
async function loadVideos() {
  const res = await fetch('/api/videos');
  const videos = await res.json();
  const list = document.getElementById('video-list');

  if (videos.length === 0) {
    list.innerHTML = `<p class="text-center text-muted">Videos not Found</p>`;
    return;
  }

  list.innerHTML = videos.map(v => `
    <div class="col-md-4">
      <div class="card shadow-sm">
        <video src="/records/${v}" class="card-img-top" controls></video>
        <div class="card-body">
          <h6 class="card-title text-center">${v}</h6>
          <h6 class="card-title text-center">
            <a href="/download/${v}" class="btn btn-primary badge"><i class="bi bi-cloud-download-fill"> Download</i></a>  
            <button class="btn btn-danger badge" onclick="deleteVideo('${v}')"> <i class="bi bi-trash3"> Delete</i></a>
          </h6>
        </div>
      </div>
    </div>
  `).join('');
}

function deleteVideo(filename) {
    Swal.fire({
      title: 'Yakin hapus?',
      text: `File "${filename}" akan dihapus permanen!`,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Ya, hapus!',
      cancelButtonText: 'Batal',
      reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        fetch(`/api/videos/${filename}`, { method: 'DELETE' })
          .then(res => res.json())
          .then(data => {
            Swal.fire({
              icon: 'success',
              title: 'Berhasil!',
              text: data.message,
              timer: 2000,
              showConfirmButton: false
            });
            loadVideos();
          })
          .catch(() => {
            Swal.fire({
              icon: 'error',
              title: 'Gagal!',
              text: 'Tidak dapat menghapus file.',
            });
          });
      }
    });
  }

  loadVideos();

// function deleteVideo(filename) {
//     if (confirm(`Yakin ingin menghapus ${filename}?`)) {
//       fetch(`/api/videos/${filename}`, { method: 'DELETE' })
//         .then(res => res.json())
//         .then(data => {
//           alert(data.message || 'Berhasil dihapus');
//           loadVideos();
//         })
//         .catch(() => alert('Gagal menghapus file'));
//     }
//   }
// loadVideos();
</script>